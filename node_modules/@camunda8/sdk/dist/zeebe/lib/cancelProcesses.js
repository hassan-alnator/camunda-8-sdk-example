"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cancelProcesses = void 0;
const operate_1 = require("../../operate");
const operate = createClient();
async function cancelProcesses(processDefinitionKey) {
    if (!operate) {
        return;
    }
    const processes = await operate
        .searchProcessInstances({
        filter: {
            processDefinitionKey,
            state: 'ACTIVE',
        },
    })
        .catch((e) => {
        console.log(`Failed to search for process instances for ${processDefinitionKey}`);
        console.log(e);
    });
    if (processes) {
        await Promise.all(processes.items.map((item) => {
            return operate.deleteProcessInstance(item.key).catch((e) => {
                console.log(`Failed to delete process ${item.key}`);
                console.log(e);
            });
        }));
    }
}
exports.cancelProcesses = cancelProcesses;
function createClient() {
    try {
        return new operate_1.OperateApiClient();
    }
    catch (e) {
        console.log(e.message);
        console.log(`Running without access to Operate`);
        return null;
    }
}
//# sourceMappingURL=cancelProcesses.js.map